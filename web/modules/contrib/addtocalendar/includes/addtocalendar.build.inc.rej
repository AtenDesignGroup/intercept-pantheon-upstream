--- includes/addtocalendar.build.inc
+++ includes/addtocalendar.build.inc
@@ -56,6 +56,8 @@ function _addtocalendar_preprocess_field(&$variables) {
         ],
       ];
 
+      /** @var \Drupal\Core\Render\RendererInterface $renderer */
+      $renderer = \Drupal::service('renderer');
       foreach ($values as $index => $date_val) {
         $date = new DrupalDateTime(preg_replace('/T/', ' ', $values[$index]['value']), $timeZone);
         if (!empty($values[$index]['end_value']) && isset($values[$index]['end_value'])) {
@@ -92,13 +94,13 @@ function _addtocalendar_preprocess_field(&$variables) {
             default:
               $field = $settings['addtocalendar_settings'][$value]['field'];
               if (strip_tags($entity->{$field}->getFieldDefinition()
-                ->getType()) == 'daterange'
+                ->getType() ?? '') == 'daterange'
               ) {
-                $class_value = strip_tags($entity->{$field}->end_value);
+                $class_value = strip_tags($entity->{$field}->end_value ?? '');
               }
               else {
                 $view = $entity->get($field)->view(['label' => 'hidden']);
-                $class_value = strip_tags(render($view));
+                $class_value = strip_tags($renderer->render($view) ?? '');
               }
               break;
           }
@@ -145,7 +147,7 @@ function _addtocalendar_preprocess_field(&$variables) {
         $build['addtocalendar'][$index] = [
           '#type' => 'html_tag',
           '#tag' => 'span',
-          '#value' => render($build['addtocalendar_button']) . '<var class="atc_event">' .render($build['addtocalendar'][$index]) . '</var>',
+          '#value' => $renderer->render($build['addtocalendar_button']) . '<var class="atc_event">' . $renderer->render($build['addtocalendar'][$index]) . '</var>',
           '#attributes' => [
             'class' => [
               'addtocalendar',
@@ -188,10 +190,10 @@ function _addtocalendar_preprocess_field(&$variables) {
       if ($multivalued && $settings['addtocalendar_settings']['multiple_value'] == 2) {
         foreach ($variables['items'] as $k => $content) {
           if (isset($variables['items'][$k]['content']['#suffix'])) {
-            $variables['items'][$k]['content']['#suffix'] .= render($build['addtocalendar'][$k]);
+            $variables['items'][$k]['content']['#suffix'] .= $renderer->render($build['addtocalendar'][$k]);
           }
           else {
-            $variables['items'][$k]['content']['#suffix'] = render($build['addtocalendar'][$k]);
+            $variables['items'][$k]['content']['#suffix'] = $renderer->render($build['addtocalendar'][$k]);
           }
           $variables['#attached']['library'][] = 'addtocalendar/base';
         }
@@ -199,10 +201,10 @@ function _addtocalendar_preprocess_field(&$variables) {
       // Setting #markup for all the date or daterange fields if single value is selected.
       else {
         if (isset($variables['items'][$delta]['content']['#suffix'])) {
-          $variables['items'][$delta]['content']['#suffix'] .= render($build['addtocalendar']);
+          $variables['items'][$delta]['content']['#suffix'] .= $renderer->render($build['addtocalendar']);
         }
         else {
-          $variables['items'][$delta]['content']['#suffix'] = render($build['addtocalendar']);
+          $variables['items'][$delta]['content']['#suffix'] = $renderer->render($build['addtocalendar']);
         }
         $variables['#attached']['library'][] = 'addtocalendar/base';
       }
