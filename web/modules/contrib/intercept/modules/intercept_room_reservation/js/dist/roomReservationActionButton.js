!function(){"use strict";var e,t={4896:function(e){e.exports=interceptClient},27997:function(e){e.exports=Drupal},34506:function(e,t,a){a.d(t,{YE:function(){return M},zg:function(){return w}});var i=a(41594),s=a.n(i),n=a(5556),r=a.n(n),o=a(84196),l=a(38123),u=a.n(l),d=a(58156),c=a.n(d),m=a(44383),p=a.n(m),h=a(4896),g=a.n(h),f=a(73032),v=a.n(f),b=a(68313),E=a(70509),_=a(47246),y=a(81521),T=a(82495),D=a(83031),C=a(14263),R=a(10092);function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},A.apply(null,arguments)}const{constants:O,api:S,select:N,utils:P}=g(),x=O,V=["image_primary","image_primary.field_media_image"],I=c()(v(),"intercept.room_reservations.customer_advanced_limit","10"),q=c()(v(),"intercept.room_reservations.customer_advanced_text"),U=(()=>{if(!P.userIsStaff())return I&&"0"!==I?u()().tz(P.getUserTimezone()).add(I,"days").format("YYYY-MM-DD"):void 0})(),k=(()=>{if(!P.userIsStaff())return q})(),Y=(()=>{if(!P.userIsStaff())return u()().tz(P.getUserTimezone()).format("YYYY-MM-DD")})(),w=(e,t)=>{if(null===e)return!0;const a=new Date;return P.getDateFromTime(e,t)>=a},M=(e,t)=>!U||(null===e||P.getDateFromTime(e,t)<=P.getDateFromTime(e,U));(0,b.NU)("isFutureDate",((e,t)=>!t||t>=P.getUserStartOfDay())),(0,b.NU)("isLessThanMaxDate",((e,t)=>{return!t||(a=t,!U||P.getDayTimeStamp(a)<=U);var a}));class F extends s().Component{constructor(e){super(e),this.state={date:null,filters:e.filters,formValues:{[x.TYPE_ROOM]:e.room||null,date:null,start:null,end:null,agreement:P.userIsStaff(),attendees:null,groupName:"",meeting:!1,[x.TYPE_MEETING_PURPOSE]:null,meetingDetails:"",refreshmentsDesc:"",user:P.getUserUuid(),showClosed:!1},room:{current:null,previous:null,exiting:!1}},this.onExited=this.onExited.bind(this)}componentDidMount(){if(this.props.event){const e={uuid:{path:"id",value:this.props.event}};this.props.fetchEvent({filters:e,include:["field_room"]})}if(this.props.room){const e={uuid:{path:"id",value:this.props.room}};this.props.fetchRooms({filters:e,sort:{title:{path:"title"}},include:[...V],headers:{"X-Consumer-ID":g().consumer}})}this.props.fetchLocations({filters:{onlyBranchLocation:{path:"field_branch_location",value:"1"},published:{path:"status",value:"1"}},fields:{[x.TYPE_LOCATION]:["title","field_location_hours","field_branch_location","status"]}}),this.props.fetchUserStatus()}componentDidUpdate(e){if(e.eventRecord!==this.props.eventRecord&&(this.handleFormChange(this.getEventValues()),this.props.onChangeRoom(c()(this,"props.eventRecord.data.relationships.field_room.data.id"))),e.step!==this.props.step){document.querySelector(".room-reservation-app__header").scrollIntoView({block:"start",behavior:"smooth"})}}onExited(){this.setState({room:{...this.state.room,exiting:!1}})}getEventValues=()=>{const{formValues:e,room:t,event:a,eventRecord:i,locationRecord:s,filters:n}=this.props,r=p()(e,["date","start","end","attendees","groupName"]);if(a&&!i)return r;const{data:o}=i,l=P.getUserTimezone(),d=P.dateFromDrupal(c()(o,"attributes.field_date_time.value")),m=P.dateFromDrupal(c()(o,"attributes.field_date_time.end_value"));return r.date||(r.date=u()(d).tz(l).startOf("day").toDate()),r.start||(r.start=u()(d).tz(l).subtract(30,"minutes").format("HHmm")),r.end||(r.end=u()(m).tz(l).add(30,"minutes").format("HHmm")),r.attendees||(r.attendees=c()(o,"attributes.field_capacity_max")||10),r.groupName||(r.groupName=c()(o,"attributes.title")),r};handleFormChange=e=>{let t=this.state.room;e[x.TYPE_ROOM]!==this.state.formValues[x.TYPE_ROOM]&&(t={current:e[x.TYPE_ROOM],previous:this.state.room.current,exiting:this.state.room.current!==this.state.room.previous}),this.setState({room:t,formValues:{...this.state.formValues,...e,[x.TYPE_ROOM]:t}})};render(){const{step:e,onChangeStep:t,detail:a,room:i,roomDetail:n,onChangeDetail:r,onChangeRoomDetail:o,userStatus:l}=this.props,{formValues:u}=this.state,{date:d,end:c,start:m}=u,p={maxDate:U,minDate:Y,maxDateDescription:k},h=[s().createElement(_.A,A({onViewRoomDetail:e=>{o(e),r(!0)},dateLimits:p},this.props)),s().createElement(y.A,A({},this.props,{dateLimits:p,onChange:this.handleFormChange,formValues:this.state.formValues})),s().createElement(T.A,A({},this.props,{dateLimits:p,onChange:this.handleFormChange,formValues:this.state.formValues}))];let g=e;return 2!==e||((e,t,a)=>null!==t&&null!==a&&null!==e&&w(t,e)&&M(a,e))(d,m,c)?2===e&&null===i&&(g=0):g=1,s().createElement("div",{className:"l--offset"},s().createElement("div",{className:"room-reservation-app__header l__header l--section"},s().createElement(E.A,A({},this.props,{step:g,onChangeStep:e=>{this.props.fetchUserStatus(),t(e)},values:this.state.formValues})),s().createElement(D.A,{userStatus:l,query:window.location.search})),s().createElement("div",{className:"l__main"},s().createElement("div",{className:"l__primary"},h[g])),s().createElement(C.A,{open:!(!a||!n),onClose:()=>{r(!1)},id:n}))}}F.propTypes={rooms:r().arrayOf(Object).isRequired,roomsLoading:r().bool.isRequired,fetchLocations:r().func.isRequired,fetchRooms:r().func.isRequired,fetchUser:r().func.isRequired,fetchUserStatus:r().func.isRequired,fetchEvent:r().func.isRequired,detail:r().bool,event:r().string,onChangeStep:r().func.isRequired,onChangeRoom:r().func.isRequired,onChangeDetail:r().func.isRequired,onChangeRoomDetail:r().func.isRequired,room:r().string,roomDetail:r().string,step:r().number,filters:r().object},F.defaultProps={view:"list",calView:"month",date:P.getUserTimeNow(),filters:{},step:0,detail:!1,roomDetail:null,room:null,event:null};(0,o.Ng)(((e,t)=>({eventRecord:t.event?N.event(t.event)(e):null,rooms:N.roomsAscending(e),roomsLoading:N.recordsAreLoading(x.TYPE_ROOM)(e),openHoursLimit:N.locationsOpenHoursLimit(e),calendarRooms:[]})),(e=>({fetchRooms:t=>{e(S[x.TYPE_ROOM].fetchAll(t))},fetchEvent:t=>{e(S[x.TYPE_EVENT].fetchAll(t))},fetchLocations:t=>{e(S[x.TYPE_LOCATION].fetchAll(t))},fetchUser:t=>{e(S[x.TYPE_USER].fetchAll(t))}})))((0,R.A)(F))},38123:function(e){e.exports=moment},40140:function(e){e.exports=interceptTheme},41594:function(e){e.exports=React},50860:function(e,t,a){var i=a(41594),s=a.n(i),n=a(75206),r=a(27997),o=a.n(r),l=a(5667),u=a(4896),d=a.n(u),c=a(5556),m=a.n(c),p=a(84196),h=a(38123),g=a.n(h),f=a(58156),v=a.n(f),b=a(72572),E=a(76896),_=a(5696),y=a(68016),T=a(73032),D=a.n(T),C=a(96746);const{utils:R}=d(),A=R.getUserUuid();class O extends s().PureComponent{render(){const{onClick:e,text:t,variant:a}=this.props;return s().createElement(C.A,{variant:a,size:"small",color:"primary",className:"action-button__button",onClick:e},t)}}O.propTypes={entityId:m().string.isRequired,onClick:m().func,text:m().string,variant:m().string},O.defaultProps={onClick:null,userId:A,mustRegister:!1,registrationAllowed:!1,registerUrl:null,text:"",variant:"outlined"};var S=O,N=a(48360),P=a(36062);class x extends s().PureComponent{getText=(e,t)=>{switch(e){case"denied":return t?"Denying":"Denied";case"approved":return t?"Approving":"Approved";case"canceled":return t?"Canceling":"Canceled";case"requested":return t?"Rerequesting":"Awaiting Approval";default:return null}};render(){const e=this.getText(this.props.status,this.props.syncing);return e?s().createElement("p",{className:"action-button__message"},e):null}}x.propTypes={status:m().string.isRequired,syncing:m().bool},x.defaultProps={syncing:!1};var V=x,I=a(44814),q=a(87612),U=a.n(q),k=a(55378),Y=a.n(k),w=a(73546),M=a(10716),F=a(30240),B=a(61434),z=a(35376),L=a(42460),j=a(54392),H=a(37374),G=a(69290),K=a(96048),$=a(75305),Q=a(25372),W=a(1434),X=a(9548),J=a(27932),Z=a(68313),ee=a(90070);const te=d().constants,ae={default:"The status of the reservation is unknown.",dirty:{requested:"Requesting reservation",approved:"Approving reservation",denied:"Denying reservation",canceled:"Canceling reservation"},syncing:{requested:"Requesting reservation",approved:"Approving reservation",denied:"Denying reservation",canceled:"Canceling reservation"},saved:{requested:"This reservation has been requested.",approved:"This reservation has been approved.",denied:"This reservation has been denied.",canceled:"This reservation has been canceled."},error:{requested:"An error occurred while requesting this reservation.",approved:"An error occurred while approving this reservation.",denied:"An error occurred while denying this reservation.",canceled:"An error occurred while canceling this reservation."}},ie=e=>s().createElement(ee.A,{type:te.TYPE_ROOM_RESERVATION,id:e.uuid,messages:ae,statusPath:"data.attributes.field_status"});ie.propTypes={uuid:m().string.isRequired};var se=ie;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},ne.apply(null,arguments)}const{constants:re,select:oe}=d(),le=re;class ue extends s().Component{constructor(e){super(e),this.state={uuid:null,state:"idle",saved:!1,disableBackdropClick:!0,disableEscapeKeyDown:!0}}handleConfirm=()=>{this.props.onConfirm()};render(){const{open:e,onCancel:t,eventNid:a,state:i,uuid:n}=this.props,{disableBackdropClick:r,disableEscapeKeyDown:o}=this.state;let l=null,u={onCancel:t};switch(i){case"idle":u={...u,confirmText:"Submit",cancelText:"Cancel",heading:"Confirm reservation request?",onConfirm:()=>{this.props.onConfirm()}};break;case"loading":u={...u,cancelText:"Cancel",heading:"Sending reservation request",onConfirm:null,onCancel:null};break;case"conflict":u={...u,heading:"This reservation time is no longer available.",cancelText:"Close"};break;case"error":u={...u,heading:"There was an unexpected error with your reservation.",cancelText:"Close",confirmText:"Try Again",onConfirm:this.handleConfirm};break;case"saved":l=s().createElement(se,{uuid:n}),u={...u,confirmText:"View Your Reservations",cancelText:"Close",heading:"",onConfirm:()=>{window.location.href="/account/room-reservations"}},a&&(u.confirmText="Back to Edit Event",u.onConfirm=()=>{window.location.href=`/node/${a}/edit`})}return s().createElement(N.A,ne({},u,{open:e,onBackdropClick:null,disableEscapeKeyDown:o,disableBackdropClick:r}),l)}}ue.propTypes={onConfirm:m().func,onCancel:m().func,open:m().bool,state:m().string,values:m().object.isRequired,eventNid:m().number},ue.defaultProps={onConfirm:null,onCancel:null,open:!1,eventNid:null,disableEscapeKeyDown:!0,disableBackdropClick:!0,state:"idle"};var de=(0,p.Ng)(((e,t)=>{const{values:a}=t;let i=null;return a[le.TYPE_EVENT]&&(i=v()(oe.event(a[le.TYPE_EVENT])(e),"data.attributes.nid")),{eventNid:i}}))(ue),ce=a(34506);function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},me.apply(null,arguments)}const{actions:pe,api:he,constants:ge,select:fe,session:ve,utils:be}=d(),Ee=ge,_e=[{key:"1",value:"Yes"},{key:"0",value:"No"}],ye=v()(D(),"intercept.room_reservations.field_publicize.description","I would like to publicize this meeting"),Te=[{key:"1",value:"Yes"},{key:"0",value:"No"}];(0,Z.NU)("isRequired",((e,t)=>""!==t)),(0,Z.NU)("isPositive",((e,t)=>t>0)),(0,Z.NU)("isRequiredIfServingRefreshments",((e,t)=>!0)),(0,Z.NU)("isRequiredIfMeeting",((e,t)=>!e.meeting||""!==t)),(0,Z.NU)("isGreaterOrEqualTo",((e,t,a)=>null===a||t>=a)),(0,Z.NU)("isLesserOrEqualTo",((e,t,a)=>null===a||t<=a)),(0,Z.NU)("isFutureDate",((e,t)=>!t||t>=be.getUserStartOfDay())),(0,Z.NU)("isFutureTime",((e,t)=>null===t||void 0===e[Ee.DATE]||(0,ce.zg)(t,e[Ee.DATE]))),(0,Z.NU)("isAfterStart",((e,t)=>null===t||e.end>e.start)),(0,Z.NU)("isAvailableDay",((e,t,a)=>be.userIsStaff()&&a.is_closed||!a.is_closed)),(0,Z.NU)("isAvailableDuration",((e,t,a)=>be.userIsStaff()&&a.has_max_duration_conflict||!a.has_max_duration_conflict)),(0,Z.NU)("isAvailableTime",((e,t,a)=>!a.has_conflict||be.userIsStaff&&!a.has_reservation_conflict));const De=s().forwardRef(((e,t)=>s().createElement(M.A,me({direction:"up",ref:t},e)))),Ce=v()(D(),"intercept.room_reservations.agreement_text",void 0);class Re extends i.PureComponent{constructor(e){super(e),this.state={expand:{refreshments:!1,meeting:!1,confirm:!1,findRoom:!1,findTime:!1},openAgreementDialog:!1,openDialog:!1,canSubmit:!1,state:"idle",uuid:null,availabilityShouldUpdate:!0},this.toggleState=this.toggleState.bind(this),this.updateValue=this.updateValue.bind(this),this.updateValues=this.updateValues.bind(this),this.toggleValue=this.toggleValue.bind(this),this.onCloseAgreementDialog=this.onCloseAgreementDialog.bind(this),this.onCloseDialog=this.onCloseDialog.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onOpenAgreementDialog=this.onOpenAgreementDialog.bind(this),this.onOpenDialog=this.onOpenDialog.bind(this),this.onValueChange=this.onValueChange.bind(this),this.disableButton=this.disableButton.bind(this),this.enableButton=this.enableButton.bind(this)}componentDidUpdate(){this.checkAvailability()}onInputChange(e){return t=>{this.updateValue(e,t.target.value)}}onValueChange(e){return t=>{this.updateValue(e,t)}}onTimeChange(e){return t=>{this.setState({availabilityShouldUpdate:!0}),this.updateValue(e,t)}}onValueUserChange(e){return t=>{this.updateValue(e,t)}}onOpenDialog=()=>{this.setState({openDialog:!0})};onCloseDialog=()=>{this.setState({openDialog:!1}),this.props.closeEditDialog()};onOpenAgreementDialog=()=>{this.setState({openAgreementDialog:!0})};onCloseAgreementDialog=()=>{this.setState({openAgreementDialog:!1})};enableButton(){this.setState({canSubmit:!0})}toggleState(e){return()=>{this.setState({expand:{...this.state.expand,[e]:!this.state.expand[e]}})}}expand(e){return()=>{this.setState({expand:{...this.state.expand,[e]:!0}})}}collapse(e){return()=>{this.setState({expand:{...this.state.expand,[e]:!1}})}}checkAvailability=()=>{const{availabilityShouldUpdate:e}=this.state,{availability:t,fetchAvailability:a,values:i}=this.props;e&&null!==i.date&&!t.loading&&(this.setState({availabilityShouldUpdate:!1}),a(this.getDayAvailabilityQuery()))};saveEntitytoStore=e=>{const{save:t,entityId:a}=this.props,i=((e,t)=>({id:t,type:Ee.TYPE_ROOM_RESERVATION,attributes:{id:t,field_attendee_count:e.attendees,field_dates:{value:g().tz(be.getDateFromTime(e.start,e.date),be.getUserTimezone()).format(),end_value:g().tz(be.getDateFromTime(e.end,e.date),be.getUserTimezone()).format()},field_group_name:e.groupName,field_meeting_purpose_details:e.meetingDetails,field_refreshments:"1"===e.refreshments,field_refreshments_description:{value:e.refreshmentsDesc},field_publicize:"1"===e.publicize,field_status:"requested",field_agreement:e.agreement},relationships:{field_event:{data:e[Ee.TYPE_EVENT]?{type:Ee.TYPE_EVENT,id:e[Ee.TYPE_EVENT]}:null},field_room:{data:{type:Ee.TYPE_ROOM,id:e[Ee.TYPE_ROOM]}},field_meeting_purpose:{data:e.meetingPurpose?{type:Ee.TYPE_MEETING_PURPOSE,id:e.meetingPurpose}:null},field_user:{data:{type:Ee.TYPE_USER,id:e.user}}}}))(e,a);return t(i).then((()=>{this.setState({uuid:a,state:"saved"})})).catch((()=>{this.setState({state:"conflict"})})),i.id};updateValue(e,t){const a={...this.props.values,[e]:t};this.props.onChange(a)}updateValues(e){const t={...this.props.values,...e};this.props.onChange(t)}toggleValue(e){this.updateValue(e,!this.props.values[e])}agreementLabel(){return s().createElement(s().Fragment,null,"I agree to the ",s().createElement("a",{onClick:this.onOpenAgreementDialog,role:"link",tabIndex:"0"},"terms of service"),".",s().createElement(E.A,{open:this.state.openAgreementDialog,onCancel:this.onCloseAgreementDialog,onClose:this.onCloseAgreementDialog,TransitionComponent:De,className:"dialog dialog--fullscreen"},s().createElement(_.A,{id:"responsive-dialog-title"},"Terms of service"),s().createElement(y.A,null,s().createElement(F.A,null,s().createElement("span",{dangerouslySetInnerHTML:{__html:Ce}})))))}getDisabledTimespans=()=>{const{availability:e,room:t}=this.props,a=v()(e,`rooms.${t}.dates`);return a?Y()(U()(a,this.onlyTodaysReservations),(e=>({start:be.getTimeFromDate(be.dateFromDrupal(e.start)),end:be.getTimeFromDate(be.dateFromDrupal(e.end))}))):[]};getDayAvailabilityQuery=()=>{const{room:e,entityId:t,values:a}=this.props,i=be.getUserTimezone(),s=g().tz(a.date,i);return{rooms:[e],start:s.clone().startOf("day"),end:s.clone().endOf("day"),exclude_uuid:[t]}};disableButton(){this.setState({canSubmit:!1})}isConflicted=()=>{const{roomAvailability:e}=this.props;return!(!e.loading&&e)||!be.userIsStaff()&&(e.has_max_duration_conflict||e.has_open_hours_conflict||e.has_reservation_conflict)};validateForm=()=>{const{max:e,min:t,roomAvailability:a}=this.props,i=be.userIsStaff()?"has_reservation_conflict":"has_conflict";let s="Room is not available at this time";v()(a,i)||!be.userIsStaff()&&isClosed||!be.userIsStaff()&&exceedsMaxDuration?this.setState({validationErrors:{start:s,end:s}}):this.setState({validationErrors:{}})};render(){const{closeEditDialog:e,combinedValues:t,event:a,meetingPurpose:i,min:n,max:r,room:o,roomAvailability:l,roomCapacity:u,step:d,values:c}=this.props,{state:m,uuid:p}=this.state,h=this.isConflicted(),g=this.getDisabledTimespans(),f=!!(e=>e&&e.data.attributes.field_requires_explanation)(i);let v=null,b=null,_=null;return this.form=s().createRef(),D().intercept.user.telephone&&D().intercept.user.email&&(b=s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Your Current Contact Information"),s().createElement("small",null,"Telephone: ",D().intercept.user.telephone,s().createElement("br",null),"Email: ",D().intercept.user.email,s().createElement("br",null),s().createElement("em",null,"Need to update your info? After finishing your reservation visit My Account > Settings.")))),D().intercept.room_reservations.refreshments_text&&(_=s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Refreshments"),s().createElement(X.A,{label:D().intercept.room_reservations.refreshments_text,value:c.refreshments,onChange:this.onValueChange("refreshments"),name:"refreshments",required:!0,options:_e}),s().createElement(W.A,{label:"Please describe your light refreshments.",value:c.refreshmentsDesc,onChange:this.onValueChange("refreshmentsDesc"),name:"refreshmentDesc",required:"1"===c.refreshments,disabled:"1"!==c.refreshments}))),v=s().createElement(Z.Ay,{className:"form__main",ref:this.form,onValidSubmit:this.onOpenDialog,onValid:this.enableButton,onInvalid:this.disableButton,validationErrors:this.state.validationErrors},s().createElement("div",{className:"l--2-col"},s().createElement("div",{className:"l__main"},s().createElement("div",{className:"l__primary"},s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Reservation Details"),s().createElement($.A,{handleChange:this.onTimeChange("date"),value:c.date,name:"date",required:!0,clearable:!1,validations:"isFutureDate",validationErrors:{isFutureDate:"Date must be in the future"}}),s().createElement(G.A,{clearable:!0,label:"Start Time",value:c.start||null,onChange:this.onTimeChange("start"),name:"start",required:!0,validations:{isFutureTime:!0,isAvailableTime:l,isAvailableDuration:l},validationErrors:{isFutureTime:"Must be in the future",isAvailableTime:"Room is not available",isAvailableDuration:"Reservation exceeds maximum duration"},min:n,max:r,step:d,disabledSpans:g,disabledExclude:"trailing"}),s().createElement(G.A,{clearable:!0,label:"End Time",value:c.end||null,onChange:this.onTimeChange("end"),name:"end",required:!0,validations:{isFutureTime:!0,isAfterStart:!0,isAvailableTime:l,isAvailableDuration:l},validationErrors:{isFutureTime:"Must be in the future",isAfterStart:"Must be after start time",isAvailableTime:"Room is not available",isAvailableDuration:"Reservation exceeds maximum duration"},min:n,max:r,step:d,disabledSpans:g,disabledExclude:"leading"}),s().createElement(Q.A,{label:"Number of Attendees",value:c.attendees,onChange:this.onValueChange("attendees"),min:u.min,name:"attendees",int:!0,required:!be.userIsStaff(),validations:{isPositive:!0,isLesserOrEqualTo:u.max,isGreaterOrEqualTo:u.min},validationErrors:{isPositive:"Attendees must be a positive number",isLesserOrEqualTo:`The maximum capacity of this room is ${u.max}`,isGreaterOrEqualTo:`The minimum capacity of this room is ${u.min}`},helperText:u.max&&`This room holds ${u.min} to ${u.max} people`}),s().createElement(W.A,{label:"Group Name",onChange:this.onValueChange("groupName"),value:c.groupName,name:"groupName",helperText:"Help others find you by name."}),s().createElement(H.A,{type:Ee.TYPE_MEETING_PURPOSE,name:"meetingPurpose",handleChange:this.onInputChange("meetingPurpose"),value:c.meetingPurpose,label:"Purpose for using this room",required:!be.userIsStaff()}),s().createElement(W.A,{label:"Description",onChange:this.onValueChange("meetingDetails"),value:c.meetingDetails,name:"meetingDetails",required:f})),b),s().createElement("div",{className:"l__secondary"},s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Account"),s().createElement(K.A,{label:"Reserved For",value:c.user,onChange:e=>this.onValueChange("user")(e.uuid),name:"user"})),_,s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Publicize"),s().createElement(X.A,{label:ye,value:c.publicize,onChange:this.onValueChange("publicize"),name:"publicize",required:!0,options:Te})),Ce&&s().createElement("div",{className:"l--subsection"},s().createElement("h4",{className:"section-title section-title--secondary"},"Terms of Service"),s().createElement(J.A,{label:this.agreementLabel(),checked:c.agreement,onChange:()=>this.toggleValue("agreement"),required:!0,value:c.agreement,name:"agreement"})),s().createElement(C.A,{size:"large",color:"secondary",className:"button button--secondary",onClick:e},"Cancel"),s().createElement(C.A,{variant:"contained",size:"large",color:"primary",type:"submit",className:"button button--primary",disabled:!this.state.canSubmit||h||!o||!c.agreement},"Save"))))),s().createElement("div",{className:"form"},v,s().createElement(de,{open:this.state.openDialog,onCancel:this.onCloseDialog,onConfirm:()=>this.saveEntitytoStore({...t,[Ee.TYPE_ROOM]:o,[Ee.TYPE_EVENT]:a}),state:m,uuid:p,values:{...t,[Ee.TYPE_ROOM]:o,[Ee.TYPE_EVENT]:a}}),s().createElement(E.A,{fullScreen:!0,open:this.state.expand.findRoom,onClose:()=>{},TransitionComponent:De,className:"dialog dialog--fullscreen"},s().createElement(B.A,{className:"dialog__app-bar app-bar"},s().createElement(z.A,null,s().createElement(L.A,{color:"inherit",onClick:this.collapse("findRoom"),"aria-label":"Close"},s().createElement(w.A,null)),s().createElement(j.A,{variant:"title",color:"inherit",className:"app-bar_heading"},"Find a Room")))))}}Re.propTypes={values:m().shape({agreement:m().bool,attendees:m().number,date:m().object,groupName:m().string,meetingDetails:m().string,meetingPurpose:m().string,refreshments:m().string,refreshmentsDesc:m().string,publicize:m().string,user:m().string,start:m().string,end:m().string}),onChange:m().func.isRequired,save:m().func.isRequired,meetingPurpose:m().object,combinedValues:m().object,room:m().string,roomCapacity:m().shape({min:m().number,max:m().number}).isRequired,event:m().string,entityId:m().string.isRequired,step:m().number,fetchAvailability:m().func.isRequired,availability:m().object.isRequired,roomAvailability:m().object},Re.defaultProps={combinedValues:{},values:{agreement:!0,attendees:null,groupName:"",meetingPurpose:"",meetingDetails:"",refreshments:"",refreshmentsDesc:"",publicize:"",user:D().intercept.user.uuid},meetingPurpose:null,room:null,event:null,step:15,hasConflict:!1,roomAvailability:{}};var Ae=(0,p.Ng)(((e,t)=>({hours:t.values.date.start&&t.room?fe.roomLocationHours(t.room,be.getDayTimeStamp(t.values.date.start))(e):fe.locationsOpenHoursLimit(e),meetingPurpose:t.values[Ee.TYPE_MEETING_PURPOSE]?fe.record(fe.getIdentifier(Ee.TYPE_MEETING_PURPOSE,t.values[Ee.TYPE_MEETING_PURPOSE]))(e):null,roomCapacity:t.room?fe.roomCapacity(t.room)(e):{min:0,max:null},getRoomReservation:t=>fe.roomReservation(t)(e)})),(e=>({save:t=>(e(pe.edit(t,Ee.TYPE_ROOM_RESERVATION,t.id)),Promise.resolve(ve.getToken().then((a=>{e(he[Ee.TYPE_ROOM_RESERVATION].sync(t.id,{headers:{"X-CSRF-Token":a}}))})).catch((e=>{console.log("Unable to save Reservation",e)}))))})))((0,I.A)(Re));function Oe(){return Oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},Oe.apply(null,arguments)}const{actions:Se,api:Ne,select:Pe,session:xe,utils:Ve}=d(),Ie=d().constants,qe=e=>({agreement:v()(e,"data.attributes.field_agreement"),attendees:v()(e,"data.attributes.field_attendee_count"),date:Ve.dateFromDrupal(v()(e,"data.attributes.field_dates.value")),groupName:v()(e,"data.attributes.field_group_name")||"",meetingPurpose:v()(e,"data.relationships.field_meeting_purpose.data.id"),meetingDetails:v()(e,"data.attributes.field_meeting_purpose_details")||"",refreshments:v()(e,"data.attributes.field_refreshments")?"1":"0",refreshmentsDesc:v()(e,"data.attributes.field_refreshments_description.value")||"",[Ie.TYPE_ROOM]:v()(e,"data.relationships.field_room.data.id"),publicize:v()(e,"data.attributes.field_publicize")?"1":"0",start:Ve.getTimeFromDate(Ve.dateFromDrupal(v()(e,"data.attributes.field_dates.value"))),end:Ve.getTimeFromDate(Ve.dateFromDrupal(v()(e,"data.attributes.field_dates.end_value"))),user:D().intercept.user.uuid});class Ue extends s().Component{constructor(e){super(e),this.state={availabilityShouldUpdate:!0,open:!1,editDialogOpen:!1,errorDialogOpen:!1,disableBackdropClick:!0,disableEscapeKeyDown:!0,dialogProps:{},formValues:{[Ie.TYPE_ROOM]:e.room||null,date:null,start:null,end:null,agreement:Ve.userIsStaff(),attendees:null,groupName:"",meeting:!1,[Ie.TYPE_MEETING_PURPOSE]:null,meetingDetails:"",refreshmentsDesc:"",user:Ve.getUserUuid()},notes:""},this.actionButton=this.actionButton.bind(this),this.editButton=this.editButton.bind(this)}componentDidMount(){this.props.fetchReservation(this.props.entityId)}componentDidUpdate(e){const{record:t,isLoading:a}=this.props,i=e.record,s=v()(t,"state.error"),n=v()(i,"state.error");a||null===t||i===t||this.setFormValues(qe(t)),this.checkAvailability(e.record),s&&!n&&this.setState({errorDialogOpen:!0})}onlyTodaysReservations=e=>{const{formValues:t}=this.state;return Ve.dateFromDrupal(e.start)<g()(v()(t,"date")).tz(Ve.getUserTimezone()).endOf("day")};getRoomAvailabilityQuery=()=>{const{formValues:e}=this.state,{record:t,entityId:a}=this.props;return{rooms:[v()(t,"data.relationships.field_room.data.id")],start:Ve.getDateFromTime(e.start,e.date),end:Ve.getDateFromTime(e.end,e.date),exclude_uuid:[a]}};getActions=e=>{const{cancel:t,deny:a,approve:i,request:s,edit:n}=this,{editDialogOpen:r}=this.state,o=Ve.userIsManager(),{record:l}=this.props,u=Ve.getTimeStamp(v()(l,"data.attributes.field_dates.value")),d=Ve.getTimeStamp(Ve.getUserTimeNow()),c=d>u,m=d-u;switch(e){case"requested":return o?[i(),a(),n()]:c&&m>=1800?null:c&&m<1800?[t()]:[n(),t()];case"denied":return o?[i(),t()]:null;case"approved":return o?[a(),n(),t()]:c&&m>=1800?null:c&&m<1800?[t()]:[n(),t()];case"canceled":return this.isConflicted()&&!r?this.getConflictedMessage():[s(),n()];default:return null}};getDialogProps=e=>{switch(e){case"requested":return{status:"requested",heading:"Are you sure you want to rerequest this reservation?"};case"denied":return{status:"denied",heading:"Are you sure you want to deny this reservation?"};case"approved":return{status:"approved",heading:"Are you sure you want to approve this reservation?"};case"canceled":return{status:"canceled",heading:"Are you sure you want to cancel this reservation?",children:this.cancellationNotesInput()};default:return null}};getConflictedMessage=()=>{const{record:e,availability:t}=this.props,a=v()(e,"data.relationships.field_room.data.id");return!t.loading&&t.rooms[a]?s().createElement("p",{className:"action-button__message"},"This reservation time is no longer available."):""};getHours=()=>{const{hours:e}=this.props;return e?{min:e.min,max:e.max.endsWith("00")?String(e.max-55):String(e.max-15)}:{min:null,max:null}};setFormValues=e=>{this.setState({formValues:{...this.state.formValues,...e}})};checkAvailability=()=>{const{availabilityShouldUpdate:e,formValues:t}=this.state,{record:a,isLoading:i,availability:s,fetchAvailability:n}=this.props;i||null===a||!e||null===t.date||null===t.start||null===t.end||t.start===t.end||s.loading||(this.setState({availabilityShouldUpdate:!1}),n(this.getRoomAvailabilityQuery()))};isConflicted=()=>{const{record:e,availability:t}=this.props,a=v()(e,"data.relationships.field_room.data.id");if(!t.loading&&t.rooms[a]){const e=t.rooms[a];return e.has_max_duration_conflict||e.has_open_hours_conflict||e.has_reservation_conflict}return!0};openDialog=e=>{this.setState({open:!0,dialogProps:this.getDialogProps(e)})};openEditDialog=()=>{this.setState({editDialogOpen:!0})};closeDialog=()=>{this.setState({open:!1})};closeEditDialog=()=>{const{record:e}=this.props;this.setState({editDialogOpen:!1}),this.setFormValues(qe(e))};closeErrorDialog=()=>{this.props.fetchReservation(this.props.entityId),this.setState({errorDialogOpen:!1})};confirmDialog=(e,t)=>{this.props.setStatusTo(e,t),this.closeDialog()};cancel=()=>this.actionButton({status:"canceled",label:"Cancel"});deny=()=>this.actionButton({status:"denied",label:"Deny"});request=()=>this.actionButton({status:"requested",label:"Rerequest"});approve=()=>this.actionButton({status:"approved",label:"Approve",variant:"contained"});edit=()=>this.editButton({label:"Edit",variant:"contained"});handleFormChange=e=>{const{record:t}=this.props;this.setState({formValues:{...qe(t),...e},availabilityShouldUpdate:!0})};handleNotesChange=e=>{this.setState({notes:e.target.value})};cancellationNotesInput=()=>!!Ve.userIsManager()&&s().createElement(b.A,{label:"Cancellation Reason",type:"text",id:"notes",onChange:this.handleNotesChange,defaultValue:this.props.notes,className:"input input--text",InputLabelProps:{className:"input__label"},inputProps:{},fullWidth:!0});actionButton(e){let{status:t,label:a,variant:i}=e;const{record:n,entityId:r}=this.props;return n?s().createElement(S,{entityId:r,type:Ie.TYPE_ROOM_RESERVATION,record:n,text:a,onClick:()=>this.openDialog(t),key:t,variant:i}):null}editButton(e){let{label:t,variant:a}=e;const{record:i,entityId:n}=this.props;return i?s().createElement(S,{entityId:n,type:Ie.TYPE_ROOM_RESERVATION,record:i,text:t,onClick:()=>this.openEditDialog(),key:"edit",variant:a}):null}dialog=()=>{const{dialogProps:e,notes:t}=this.state;return s().createElement(N.A,Oe({},e,{open:this.state.open,onClose:this.onDialogClose,onCancel:this.closeDialog,onBackdropClick:null,disableEscapeKeyDown:this.state.disableEscapeKeyDown,disableBackdropClick:this.state.disableBackdropClick,onConfirm:()=>this.confirmDialog(e.status,t),confirmText:"Yes"}))};editDialog=()=>{const{record:e,entityId:t,availability:a}=this.props,i=Ve.userIsStaff()?{min:"0000",max:"2400"}:this.getHours(),n=e?`Edit Reservation ${v()(e,"data.attributes.location")}`:"Edit Reservation",r=v()(e,"data.relationships.field_room.data.id");return e?s().createElement(E.A,{open:this.state.editDialogOpen,onClose:this.closeEditDialog,"aria-labelledby":"responsive-dialog-title",onBackdropClick:this.closeEditDialog,maxWidth:"md"},s().createElement(_.A,{id:"responsive-dialog-title"},n),s().createElement(y.A,null,s().createElement(Ae,{closeEditDialog:this.closeEditDialog,entityId:t,values:this.state.formValues,combinedValues:this.state.formValues,onChange:this.handleFormChange,min:i.min,max:i.max,room:r,event:v()(e,"data.relationships.field_event.data.id"),roomAvailability:v()(a,`rooms.${r}`)}))):null};errorDialog=()=>{const{dialogProps:e}=this.state,{record:t}=this.props,a=(v()(t,"state.error.errors")||[]).map((e=>e.detail.replace("Entity is not valid: ","")))||"Unknown Error";return s().createElement(N.A,Oe({},e,{open:this.state.errorDialogOpen,onClose:this.closeErrorDialog,onConfirm:this.closeErrorDialog,onBackdropClick:null,disableEscapeKeyDown:this.state.disableEscapeKeyDown,disableBackdropClick:this.state.disableBackdropClick,heading:"Unable to update reservation",text:a,confirmText:"Close"}))};render(){const{record:e,isLoading:t}=this.props,a=v()(e,"data.attributes.field_status")||this.props.status,i=t?s().createElement(P.A,{loading:t,size:20}):this.getActions(a);return s().createElement("div",{className:"reservation-register-button__inner"},s().createElement(V,{status:a,syncing:v()(e,"state.syncing")}),i,this.dialog(),this.editDialog(),this.errorDialog())}}Ue.propTypes={entityId:m().string.isRequired,type:m().string.isRequired,status:m().string.isRequired,fetchReservation:m().func.isRequired,fetchAvailability:m().func.isRequired,availability:m().object.isRequired,isLoading:m().bool,setStatusTo:m().func.isRequired,record:m().object,notes:m().string},Ue.defaultProps={record:null,isLoading:!1,notes:null};var ke=(0,p.Ng)(((e,t)=>{const a=Pe.record(Pe.getIdentifier(Ie.TYPE_ROOM_RESERVATION,t.entityId))(e),i=v()(a,"data.relationships.field_room.data.id"),s=qe(a);return{hours:s&&s.date&&i?Pe.roomLocationHours(i,Ve.getDayTimeStamp(s.date))(e):Pe.locationsOpenHoursLimit(e),room:i,rooms:Pe.roomsAscending(e),record:a,notes:v()(a,"data.attributes.notes"),isLoading:Pe.recordsAreLoading(Ie.TYPE_ROOM_RESERVATION)(e)||Pe.recordIsLoading(Ie.TYPE_ROOM_RESERVATION,t.entityId)(e)}}),((e,t)=>{const a=t.entityId,{type:i}=t;return{setStatusTo:(t,s,n)=>{((t,s,n)=>{const{data:r}=s;r.attributes.field_status=t,n&&(r.attributes.notes=n),e(Se.edit(r,i,a))})(t,s,n),xe.getToken().then((t=>{e(Ne[i].sync(a,{headers:{"X-CSRF-Token":t}}))})).catch((e=>{console.log("Unable to save Reservation",e)}))},fetchReservation:t=>{e(Ne[Ie.TYPE_ROOM_RESERVATION].fetchResource(t,{include:["field_room","field_room.field_location"],fields:{[Ie.TYPE_ROOM]:["field_capacity_max","field_capacity_min","field_location"]}}))}}}),(function(e,t,a){return{...a,...e,...t,setStatusTo:(a,i)=>t.setStatusTo(a,e.record,i)}}))((0,I.A)(Ue));const Ye=(0,l.A)(ke);function we(e){const t=e.getAttribute("data-reservation-uuid"),a=e.getAttribute("data-status");(0,n.render)(s().createElement(Ye,{entityId:t,isStaff:d().utils.userIsStaff(),status:a,type:d().constants.TYPE_ROOM_RESERVATION}),e)}o().behaviors.roomReservationActionButtonApp={attach:e=>{[...e.getElementsByClassName("js--room-reservation-action")].map(we)}}},73032:function(e){e.exports=drupalSettings},75206:function(e){e.exports=ReactDOM}},a={};function i(e){var s=a[e];if(void 0!==s)return s.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return t[e](n,n.exports,i),n.loaded=!0,n.exports}i.m=t,e=[],i.O=function(t,a,s,n){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],n=e[d][2];for(var o=!0,l=0;l<a.length;l++)(!1&n||r>=n)&&Object.keys(i.O).every((function(e){return i.O[e](a[l])}))?a.splice(l--,1):(o=!1,n<r&&(r=n));if(o){e.splice(d--,1);var u=s();void 0!==u&&(t=u)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,s,n]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},i.j=817,function(){var e={817:0};i.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,n,r=a[0],o=a[1],l=a[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var d=l(i)}for(t&&t(a);u<r.length;u++)n=r[u],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},a=self.wpJsonpIntercept=self.wpJsonpIntercept||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var s=i.O(void 0,[436],(function(){return i(50860)}));s=i.O(s)}();